<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>-</title>
    <script src="https://cdn.ethers.io/lib/ethers-5.2.umd.min.js" type="application/javascript"></script>
</head>

<body>
    <h1 id="myHeading">我的第一个标题8</h1>
    <script>
        var h1Element = document.getElementById('myHeading');
        let is_Native = false;
        sendToCocos({
            fun: "webReady",
            data: null,
        });

        function setIsNative() {
            h1Element.textContent += '\n' + 'is_Native---->';
            is_Native = true;
            h1Element.textContent += '\n' + 'is_Native2---->';
        }

        function strToFun(data) {
            h1Element.textContent += '\n' + 'strToFun===>' + data;
            try {
                data = data && JSON.parse(data); //参数
            } catch (error) {
                h1Element.textContent += '\n' + 'error---->' + error.toString();
            }
            if (!data) return;
            console.log("web接收:", data);
            h1Element.textContent += '\n' + 'strToFun---->' + data.fun;
            window[data.fun] && window[data.fun](data.parm);
        }
        //web接收来自cocos的消息
        window.addEventListener('message', function (e) {
            h1Element.textContent += '\n' + 'Web---->' + e.data;
            let data = e.data;
            if (!data.startsWith("_ToWeb")) return;
            data = data.replace("_ToWeb", "");
            strToFun(data);
        });
        // 安卓时接受cocos数据
        function cocosToWeb(params) {
            try {
                h1Element.textContent += '\n' + 'Ntv-=-=--=>' + params ? JSON.stringify(params) : '';
            } catch (error) {
                h1Element.textContent += '\n' + 'Ntv++error---->' + error.toString();
            }
            strToFun(params);
        }

        function sendToCocos(data) {
            h1Element.textContent += '\n' + 'sendToCocos---->' + JSON.stringify(data);
            h1Element.textContent += '\n' + 'isNative---->';
            //android or ios
            // document.location = 'testkey://' + "a=1&b=2";
            document.location = 'testkey://' + encodeURIComponent(JSON.stringify(data));
            // parent.onWebToCocos && parent.onWebToCocos(JSON.stringify(data));
            // if (is_Native) {
            // } else {
            //     //browser 浏览器下，向cocos发送消息
            //     parent.postMessage("_ToCocos" + JSON.stringify(data), "*");
            // }
        }


        function getBalance(param) {
            try {
                h1Element.textContent += '\n' + 'getBalance---->';
                const provider = new ethers.providers.JsonRpcProvider("https://rpc-amoy.polygon.technology");
                provider.getBalance("0x715f63fb9ba17d0601cd857be33e901ce817e383", 'latest').then((data) => {
                    sendToCocos({
                        fun: "getBalance",
                        data
                    });
                });
            } catch (error) {
                h1Element.textContent += '\n' + 'error---->' + JSON.stringify(error);
            }
        }
    </script>
</body>

</html>
